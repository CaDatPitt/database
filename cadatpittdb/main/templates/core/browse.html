{% extends "core/base.html" %}
{% load static %}
{% load strfilters %}
{% block title %}{{ title }}{% endblock %}
{% block head %}
<link rel="stylesheet" href="{% static 'main.css' %}">
{% endblock%}
{% block navbar_browse %}class="nav-link active"{% endblock %}
{% block content %}

<!-- First Section-->
<h2>Browse Datasets</h2>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque aliquet sapien eget pulvinar venenatis. Quisque imperdiet dolor at cursus hendrerit. In consectetur porttitor ultrices.</p>

<div class="d-grid gap-2 d-sm-flex justify-content-center justify-content-lg-start my-4">
    <!-- <a class="btn btn-primary btn-action bg-pitt-royal border-pitt-royal"
        href="" role="button">Browse All</a> -->
    <a class="btn btn-primary btn-action bg-pitt-royal border-pitt-royal"
        data-bs-toggle="collapse" data-bs-target="#browseByTagCollapse" 
        aria-expanded="false" aria-controls="browseByTagButton"
        href="" role="button">Browse by Tag</a>
</div>
<div class="collapse" id="browseByTagCollapse">
    {% for tag in tags %}
    {% if tag.get_num_datasets > 0 %}
    <a role="button" href="/tag/?title={{ tag }}" 
        class="btn btn-warning bg-pitt-gold badge-tag text-pitt-dark-blue">
        {{ tag }} 
        <span class="badge bg-pitt-royal">{{ tag.get_num_datasets }}</span>
    </a>
    {% endif %}
    {% endfor %}
</div>

<hr class="my-4"/>

<!-- Second Section -->
<div class="row gy-4">
    
    <!--Filters-->
    <div class="col-md col-lg-4">
        <h5 align="left">Filters</h5>
        <div class="card shadow-sm bg-light-gray">
            <div class="card-body">
                <form method="POST">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="keywords" class="bold">
                            Keywords 
                            <span 
                                data-bs-toggle="tooltip" data-bs-placement="bottom"
                                data-bs-title='Find datasets that contain your 
                                keywords. Search on a single phrase or multiple 
                                phrases by putting quotes around each and 
                                separating them with an OR like: "August Wilson"
                                OR "Century Cycle"'>&#x1F6C8;
                            </span>
                        </label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="keywords" 
                            name="keywords">
                    </div>
                    <br />
                    <div class="form-group">
                        <label for="title" class="bold">Title
                            <span 
                                data-bs-toggle="tooltip" data-bs-placement="bottom"
                                data-bs-title='Enter help text here'>&#x1F6C8;
                            </span>
                        </label>
                        <input 
                          type="text" 
                          class="form-control" 
                          id="title" 
                          name="title">
                      </div>
                    <br />
                    <div class="form-group">
                        <label for="creator" class="bold">
                            Created By
                            <span 
                                data-bs-toggle="tooltip" data-bs-placement="bottom"
                                data-bs-title='Find datasets created by specific
                                users. Search for a single user or multiple 
                                users by using the AND and OR operators'>&#x1F6C8;
                            </span>
                        </label>
                        <select 
                            class="form-control"
                            id="creator"
                            name="creator" 
                            multiple>
                            <option value="" disabled>Select user(s)</option>
                            {% for creator in creators %}
                            <option value="{{ creator.user_id }}">
                                {{ creator.first_name }} {{ creator.last_name}} 
                                ({{ creator.username}})
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <br />
                    <div class="form-group">
                        <label for="description" class="bold">
                            Description
                            <span 
                                data-bs-toggle="tooltip" data-bs-placement="bottom"
                                data-bs-title='Enter help text here'>&#x1F6C8;
                            </span>
                        </label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="description" 
                            name="description">
                        </div>
                    <br/>
                    <div class="form-group">
                        <label for="tags" class="bold">
                            Tags
                            <span 
                                data-bs-toggle="tooltip" data-bs-placement="bottom"
                                data-bs-title='Enter help text here'>&#x1F6C8;
                            </span>
                        </label>
                        <select 
                            class="form-control"
                            id="tags"
                            name="tags" 
                            multiple>
                            <option value="" disabled>Select tag(s)</option>
                            {% for tag in tags %}
                            <option value="{{ tag.tag_id }}">
                                {{ tag.text }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col">   
                            <div class="form-group">
                                <label for="min_num_items" class="bold">Min # of Items
                                    <span 
                                        data-bs-toggle="tooltip" data-bs-placement="bottom"
                                        data-bs-title='Enter help text here'>&#x1F6C8;
                                    </span>
                                </label>
                                <input 
                                    type="number" 
                                    class="form-control" 
                                    id="min_num_items" 
                                    name="min_num_items"
                                    min="1" max="500000" 
                                    step="1">
                            </div>
                        </div>
                        <div class="col">   
                            <div class="form-group">
                                <label for="min_num_items" class="bold">Max # of Items
                                    <span 
                                        data-bs-toggle="tooltip" data-bs-placement="bottom"
                                        data-bs-title='Enter help text here'>&#x1F6C8;
                                    </span>
                                </label>
                                <input 
                                    type="number" 
                                    class="form-control" 
                                    id="min_num_items" 
                                    name="min_num_items"
                                    min="1" max="500000" 
                                    step="1">
                            </div>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col">   
                            <div class="form-group">
                                <label for="start_date" class="bold">Modification Date
                                    <span 
                                        data-bs-toggle="tooltip" data-bs-placement="bottom"
                                        data-bs-title='Enter help text here'>&#x1F6C8;
                                    </span>
                                </label>
                                <input 
                                    type="date" 
                                    class="form-control" 
                                    id="start_date" 
                                    name="start_date">
                            </div>
                        </div>
                        <div class="col">   
                            <div class="form-group">
                                <label for="end_date" class="bold"></label>
                                <input 
                                    type="date" 
                                    class="form-control" 
                                    id="start_date" 
                                    name="start_date">
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="col-md-12 text-center">
                        <button type="submit" class="btn btn-primary bg-pitt-royal border-pitt-royal">
                            Apply Filters
                        </button>
                    </div>
                </form>
            </div>
        </div> 
    </div>
    
    <!--Dataset Cards-->
    <div class="col-md col-lg-8">
        <h5 align="left">Datasets</h5>
        <p><em>{{ datasets|length }} datasets</em></p>
        <div class="row gy-4">
            {% for dataset in datasets %}
            <div class="col-sm-12">
                <div class="card h-100 shadow-sm bg-light-gray">
                    <div class="card-header">
                        <div class="row">
                            <div class="col-9">
                                <strong>Created by</strong>: 
                                <a href="/profile/?user={{ dataset.creator.username }}"
                                >{{ dataset.creator }}</a>
                            </div>
                            <div class="col-3 text-end">
                                {% include 'snippets/pin-dataset-icon.html' %}
                                {% include 'snippets/tag-dataset-icon.html' %}
                                {% include 'snippets/edit-dataset-icon.html' %}
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <h6 class="card-title">
                            <a href="/dataset?id={{ dataset.public_id }}">{{ dataset.title }}</a>
                        </h6>
                        <h* class="card-subtitle">{{ dataset.description|truncatewords:50 }}</h*>
                        <p class="card-text mt-2"><strong># of items</strong>: 
                            {{ dataset.items.all|length }}<br/>
                        <strong>Last modified</strong>: {{ dataset.last_modified|truncate_date }}
                        </p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Dataset Modals -->
{% for dataset in datasets %}
  {% include 'snippets/tag-dataset-modal.html' %}
  {% include 'snippets/edit-dataset-modal.html' %}
{% endfor %}

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
<script>
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
  })
</script>
{% endblock %}
{% block bootstrapjs %}
{% endblock %}
