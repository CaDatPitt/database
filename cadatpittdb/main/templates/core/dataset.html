{% extends "core/base.html" %}
{% load static %}
{% block title %}{{ title }}{% endblock %}
{% block head %}
<link rel="stylesheet" href="{% static 'main.css' %}">
<link rel="stylesheet" href="{% static 'tagin/dist/tagin.min.css' %}" />
{% endblock %}
{% block content %}

<!-- Dataset Information -->
<h1>{{ dataset.title }}</h1>
<p class="contact"><strong>Created By:</strong> 
  <a href="/profile/?user={{ dataset.creator.username }}">
    {{ dataset.creator }}
  </a>
</p>
<p class="contact"><strong>Description:</strong> {{ dataset.description }}</p>
<p class="contact"><strong>Tags:</strong> 
  {% for tag in dataset.tags.all %}
  {{ tag }}{% if tag != dataset.tags.all.last %},{% endif %}
  {% endfor %}
</p>
<p class="contact"><strong>Last modified</strong>: {{ dataset.last_modified }}</p>
<br/>

<!-- Dataset Action Buttons -->
<div class="d-grid gap-2 d-sm-flex justify-content-center justify-content-sm-start">
  {% if user == dataset.creator %}
    <div class="btn-group">
      <button type="button" data-bs-toggle="dropdown" aria-expanded="false"
        class="btn btn-primary btn-action dropdown-toggle bg-pitt-royal border-pitt-royal">
        Edit Dataset
      </button>
      <ul class="dropdown-menu">
        <li>
          <a data-bs-toggle="modal" data-bs-target="#editDatasetModal"
            class="dropdown-item" href="">Edit copy</a>
        </li>
        <li>
          <a class="dropdown-item" 
            href="/edit/?id={{ dataset.public_id }}">Edit original</a>
        </li>
      </ul>
    </div>
  {% else %}
  <a class="btn btn-primary btn-action bg-pitt-royal border-pitt-royal"
   data-bs-toggle="modal" data-bs-target="#editDatasetModal"
    href="" role="button">Edit Dataset</a>
  {% endif %}
  <a class="btn btn-primary btn-action bg-pitt-royal border-pitt-royal"
    href="" role="button">Pin Dataset</a>
  <a class="btn btn-primary btn-action bg-pitt-royal border-pitt-royal"
    href="" role="button">Download Dataset</a>
</div>

<hr style="margin-top: 1.75em;"/>

<!-- Items -->
<h4 class="mb-4">Items</h4>
<div class="row gy-4">
  {% for item in dataset.items.all %}
  <div class="col-lg-6">
    <div class="card item-card shadow-sm bg-light-gray">
      <img src="{{ item.thumbnail }}" class="card-img-top item-thumbnail" />
      <div class="card-body">
        <div class="row">
          <div class="col text-end border-bottom mb-2 pb-2">
            {% include 'snippets/pin-item-icon.html' %}
            {% include 'snippets/add-item-icon.html' %}
            {% include 'snippets/remove-item-icon.html' %}
          </div>
        </div>
        <a href="/item/?id={{ item.item_id }}">
          <h5 class="card-title">{{ item.title }}</h5>
        </a>
        <p>
          <strong>Date:</strong> {{ item.date }}<br/>
          <strong>Type:</strong> 
          {% for type in item.get_types %}
          {{ type|title }}{% if type != item.get_types|last %},{% endif %}
          {% endfor %}
          <br/>
          <strong>Collections:</strong> 
          {% for collection in item.collections.all %}
          <br/>    
          <a href="{{ collection.get_urls.0 }}" target="_blank">{{ collection }}</a>
          {% endfor %}
        </p>
        <a role="button" class="btn btn-warning pitt-gold"
          href="https://digital.library.pitt.edu/islandora/object/{{ item.item_id}} " 
          target="_blank">
        View Full Item Info
        </a>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Edit Dataset Form Modal -->
<div class="modal fade" id="editDatasetModal" name="editDatasetModal" 
  tabindex="-1" aria-labelledby="editDatasetModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="editDatasetModalLabel">Name Copy of Dataset</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" 
          aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Create Dataset Form -->
        <div id="create_dataset_form">
          <form method="POST" action="/copy/?id={{ dataset.public_id }}">
            {% csrf_token %}
            <div class="form-group">
              <label for="title" class="bold">Title
                <span class="required-field">*</span>
              </label>
              <input 
                type="text" 
                class="form-control" 
                id="title" 
                name="title"
                required>
            </div>
            <br/>
            <div class="col-md-12 text-center">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-warning pitt-gold">Submit</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Add Item Modals -->
{% for item in dataset.items.all %}
  {% include 'snippets/add-item-modal.html' %}
{% endfor %}

<!-- Remove Item Modals -->
{% for item in dataset.items.all %}
  {% include 'snippets/remove-item-modal.html' %}
{% endfor %}

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
<script>
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
  return new bootstrap.Tooltip(tooltipTriggerEl)
  })
</script>
<script src="{% static 'tagin/dist/tagin.js' %}"></script>
<script>
  const tagin = new Tagin(document.querySelector('.tagin'), {
  separator: '|||',
  duplicate: false,
  enter: true,
  transform: 'input => input',
  placeholder: 'Type tag name and press Enter/Return too add'
  })
</script>
{% endblock %}
{% block bootstrapjs %}
{% endblock %}
